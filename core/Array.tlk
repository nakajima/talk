struct Array<T> {
	let count: Int  
	let capacity: Int
	let storage: Pointer

	init(capacity: Int) {
		self.count = 0
		self.capacity = capacity
		self.storage = __alloc<T>(capacity)
	}

	func push(element: T) {
		self.resizeIfNeeded()
		__store<T>(self.storage, self.count, element)
		self.count = self.count + 1
	}

	func get(index: Int) -> T {
		__load<T>(self.storage, index)
	}

	func resizeIfNeeded() {
		if self.count + 1 > self.capacity {
			let newStorage = __alloc<T>(self.capacity * 2)
			let i = 0
			loop i < self.count {
				__store<T>(newStorage, i, self.get(i))
				i = i + 1
			}
			__free(self.storage)
			self.storage = newStorage
		}
	}
}
