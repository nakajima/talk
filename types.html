<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Types Visualization</title>
  <style>
    :root {
      --bg: #1a1a2e;
      --bg-accent: #16213e;
      --panel: #0f0f23;
      --ink: #e8e8e8;
      --muted: #888;
      --accent: #00d9ff;
      --accent-2: #ff6b6b;
      --hover: rgba(0, 217, 255, 0.15);
      --line: rgba(255, 255, 255, 0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--ink);
      font-family: "JetBrains Mono", "Fira Code", monospace;
      font-size: 13px;
      line-height: 1.6;
    }
    main {
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px;
    }
    .page-header {
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--line);
    }
    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.2em;
      font-size: 11px;
      color: var(--accent);
      margin-bottom: 4px;
    }
    h1 { font-size: 24px; font-weight: 600; }
    h2 { font-size: 16px; font-weight: 600; margin-bottom: 12px; }
    h3 { font-size: 14px; font-weight: 600; color: var(--muted); margin-bottom: 8px; }
    .subtitle { color: var(--muted); font-size: 13px; }
    .panels {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      height: calc(100vh - 140px);
    }
    section {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 16px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .section-header {
      margin-bottom: 12px;
      flex-shrink: 0;
    }
    .file-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 12px;
      flex-shrink: 0;
    }
    .file-tab {
      background: transparent;
      border: 1px solid var(--line);
      color: var(--muted);
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    .file-tab.active {
      background: var(--accent);
      color: var(--bg);
      border-color: var(--accent);
    }
    .file-content { overflow: auto; flex: 1; }
    .source {
      background: var(--bg-accent);
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.6;
    }
    .source code { display: block; white-space: pre; }
    .typed-node {
      cursor: pointer;
      border-radius: 2px;
      transition: background 0.1s;
    }
    .typed-node:hover {
      background: var(--hover);
    }
    .typed-node.selected {
      background: rgba(0, 217, 255, 0.3);
      outline: 1px solid var(--accent);
    }
    .type-panel {
      overflow: auto;
    }
    .type-info {
      flex: 1;
      overflow: auto;
    }
    .hint {
      color: var(--muted);
      font-style: italic;
    }
    .type-display {
      background: var(--bg-accent);
      padding: 12px;
      border-radius: 4px;
      margin-bottom: 12px;
    }
    .type-display h4 {
      color: var(--accent);
      font-size: 12px;
      margin-bottom: 8px;
    }
    .type-display pre {
      white-space: pre-wrap;
      word-break: break-all;
    }
    .node-id {
      color: var(--muted);
      font-size: 11px;
    }
  </style>
</head>
<body>
<main>
<header class="page-header">
  <div>
    <p class="eyebrow">Type Checker</p>
    <h1>Types Visualization</h1>
    <p class="subtitle">10 nodes with types</p>
  </div>
</header>
<div class="panels">
<section class="source-panel">
  <div class="section-header">
    <h2>Source</h2>
  </div>
  <div class="file-content" data-file="0" style="display: block">
    <h3>:memory:</h3>
    <pre class="source"><code>
      <span class="typed-node" data-node="0:5" data-type="?">protocol A {
        func fizz() -&gt; Int
      }</span>

      <span class="typed-node" data-node="0:7" data-type="?">struct B {}</span>
      <span class="typed-node" data-node="0:16" data-type="?">extend B: A {
        init() { }

        func fizz() { <span class="typed-node" data-node="0:11" data-type="Int">123</span> }
      }</span>

      <span class="typed-node" data-node="0:27" data-type="?">func callIt&lt;T: A&gt;(t: T) {
        <span class="typed-node" data-node="0:24" data-type="Int">t.fizz()</span>
      }</span>

      <span class="typed-node" data-node="0:32" data-type="Int">callIt(B())</span>
    </code></pre>
  </div>
</section>
<section class="type-panel">
  <div class="section-header">
    <h2>Type Info</h2>
  </div>
  <div class="type-info" id="type-info">
    <p class="hint">Hover over code to see types</p>
  </div>
</section>
</div>
</main>

<script>
const typeInfo = document.getElementById('type-info');
let selectedNode = null;

document.querySelectorAll('.typed-node').forEach(node => {
  node.addEventListener('mouseenter', function() {
    showTypeInfo(this);
  });

  node.addEventListener('click', function(e) {
    e.stopPropagation();
    if (selectedNode) {
      selectedNode.classList.remove('selected');
    }
    this.classList.add('selected');
    selectedNode = this;
    showTypeInfo(this, true);
  });
});

document.addEventListener('click', function() {
  if (selectedNode) {
    selectedNode.classList.remove('selected');
    selectedNode = null;
  }
});

function showTypeInfo(node, pinned = false) {
  const nodeId = node.dataset.node;
  const type = node.dataset.type;
  const code = node.textContent.substring(0, 100) + (node.textContent.length > 100 ? '...' : '');

  typeInfo.innerHTML = `
    <div class="type-display">
      <h4>Expression</h4>
      <pre>${escapeHtml(code)}</pre>
    </div>
    <div class="type-display">
      <h4>Type</h4>
      <pre>${escapeHtml(type)}</pre>
    </div>
    <p class="node-id">NodeID: ${nodeId}</p>
    ${pinned ? '<p class="hint">Click elsewhere to deselect</p>' : ''}
  `;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// File tabs
document.querySelectorAll('.file-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    const fileIndex = this.dataset.file;
    document.querySelectorAll('.file-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.file-content').forEach(c => c.style.display = 'none');
    this.classList.add('active');
    document.querySelector(`.file-content[data-file="${fileIndex}"]`).style.display = 'block';
  });
});
</script>
</body>
</html>
